<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>MK Sky Chat ğŸ”</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyArNyQuHcSAT-IFW1_RK9baKGofNUhltbI",
      authDomain: "mk-sky-26496.firebaseapp.com",
      projectId: "mk-sky-26496",
      storageBucket: "mk-sky-26496.appspot.com",
      messagingSenderId: "944673432847",
      appId: "1:944673432847:web:b057025763453302298a7a",
      measurementId: "G-DE8LW0N4XW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    const messagesRef = ref(db, "messages");

    window.onload = () => {
      const loginScreen = document.getElementById("loginScreen");
      const chatScreen = document.getElementById("chatScreen");
      const registerBtn = document.getElementById("registerBtn");
      const loginBtn = document.getElementById("loginBtn");
      const logoutBtn = document.getElementById("logoutBtn");

      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const nameInput = document.getElementById("name");
      const messageInput = document.getElementById("message");
      const sendBtn = document.getElementById("send");
      const chatBox = document.getElementById("chat");

      // Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø®Ø±ÙˆØ¬Ù‡
      onAuthStateChanged(auth, (user) => {
        if (user) {
          loginScreen.style.display = "none";
          chatScreen.style.display = "block";
        } else {
          chatScreen.style.display = "none";
          loginScreen.style.display = "block";
        }
      });

      registerBtn.onclick = () => {
        const email = emailInput.value;
        const password = passwordInput.value;
        createUserWithEmailAndPassword(auth, email, password)
          .then(() => alert("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨"))
          .catch((error) => alert("âŒ " + error.message));
      };

      loginBtn.onclick = () => {
        const email = emailInput.value;
        const password = passwordInput.value;
        signInWithEmailAndPassword(auth, email, password)
          .catch((error) => alert("âŒ " + error.message));
      };

      logoutBtn.onclick = () => {
        signOut(auth);
      };

      sendBtn.onclick = () => {
        const user = auth.currentUser;
        const name = nameInput.value.trim() || user.email;
        const message = messageInput.value.trim();
        if (message) {
          push(messagesRef, { name, message });
          messageInput.value = "";
        }
      };

      onChildAdded(messagesRef, (snapshot) => {
        const data = snapshot.val();
        const div = document.createElement("div");
        div.innerText = `${data.name}: ${data.message}`;
        chatBox.appendChild(div);
      });
    };
  </script>
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginScreen">
    <h3>ğŸšª Ø¯Ø®ÙˆÙ„ Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„</h3>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
    <button id="registerBtn">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
  <div id="chatScreen" style="display:none;">
    <h2>ğŸ’¬ MK Sky Chat</h2>
    <button id="logoutBtn">Ø®Ø±ÙˆØ¬</button>
    <br><br>
    <input type="text" id="name" placeholder="Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
    <input type="text" id="message" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©">
    <button id="send">Ø¥Ø±Ø³Ø§Ù„</button>
    <hr>
    <div id="chat" style="border:1px solid #ccc; padding:10px; max-height:300px; overflow:auto;"></div>
  </div>
</body>
</html>
